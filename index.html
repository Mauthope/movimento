<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Distribuição de Bobinas</title>
  <style>
    .success { color: green; }
    .error { color: red; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #ddd; padding: 8px; text-align: center; }
  </style>
</head>
<body>
  <h1>Distribuição de Bobinas</h1>

  <label for="capacity">Capacidade do Rebocador (Bobinas por minuto):</label>
  <input type="number" id="capacity" placeholder="Capacidade do rebocador">
  <br>
  <label for="cycleTime">Tempo de ciclo (minutos):</label>
  <input type="number" id="cycleTime" placeholder="Tempo de ciclo">
  <br>
  <button id="calculateBtn">Calcular</button>

  <h2>Status</h2>
  <p id="statusText"></p>

  <h2>Tabela de Resultados</h2>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Setor</th>
        <th>Consumo / Velocidade</th>
        <th>Demanda por Minuto</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados dinâmicos serão inseridos aqui -->
    </tbody>
  </table>

  <h2>Tabela de Distribuição</h2>
  <table id="distributionTable">
    <thead>
      <tr>
        <th>Viagem</th>
        <th>Setor 1</th>
        <th>Setor 2</th>
        <th>Setor 3</th>
        <th>Setor 4</th>
        <th>Setor 5</th>
      </tr>
    </thead>
    <tbody>
      <!-- Distribuições dinâmicas serão inseridas aqui -->
    </tbody>
  </table>

  <script>
    document.getElementById("calculateBtn").addEventListener("click", function () {
      const capacityInput = document.getElementById("capacity");
      const cycleTimeInput = document.getElementById("cycleTime");
      const statusText = document.getElementById("statusText");
      const resultTable = document.getElementById("resultTable").getElementsByTagName('tbody')[0];
      const distributionTable = document.getElementById("distributionTable").getElementsByTagName('tbody')[0];

      // Setores (exemplo com dados)
      const sectors = [
        { name: "Setor 1", consumption: 100, speed: 2, isBobinasPerHour: false, multiplier: 1 },
        { name: "Setor 2", consumption: 80, speed: 3, isBobinasPerHour: false, multiplier: 1 },
        { name: "Setor 3", consumption: 150, speed: 4, isBobinasPerHour: false, multiplier: 1 },
        { name: "Setor 4", bobinasPerHour: 120, isBobinasPerHour: true, multiplier: 1 },
        { name: "Setor 5", bobinasPerHour: 90, isBobinasPerHour: true, multiplier: 1 }
      ];

      // Limpar as tabelas e o status anterior
      resultTable.innerHTML = "";
      distributionTable.innerHTML = "";
      statusText.textContent = "";

      const rebocadorCapacity = parseFloat(capacityInput.value) || 0;
      const cycleTime = parseFloat(cycleTimeInput.value) || 0;

      let totalDemandPerMinute = 0;
      sectors.forEach(sector => {
        if (!sector.isBobinasPerHour) {
          // Calcula demanda por bobina por minuto
          const bobinasPerMinute = (sector.consumption / sector.speed) / 60;
          totalDemandPerMinute += bobinasPerMinute * sector.multiplier;
        } else {
          // Usa o valor diretamente para bobinas por hora
          totalDemandPerMinute += sector.bobinasPerHour / 60;
        }
      });

      const rebocadorCapacityPerMinute = rebocadorCapacity / cycleTime;

      if (totalDemandPerMinute <= rebocadorCapacityPerMinute) {
        statusText.textContent = "O rebocador tem capacidade suficiente!";
        statusText.className = "success";
      } else {
        statusText.textContent = "A capacidade do rebocador não é suficiente.";
        statusText.className = "error";
      }

      // Preencher a tabela de resultados
      sectors.forEach(sector => {
        const tr = document.createElement("tr");
        if (sector.isBobinasPerHour) {
          const bobinasPerMinute = sector.bobinasPerHour / 60;
          tr.innerHTML = `<td>${sector.name}</td><td>Bobinas por Hora: ${sector.bobinasPerHour}</td><td>${bobinasPerMinute.toFixed(4)}</td>`;
        } else {
          const bobinasPerMinute = (sector.consumption / sector.speed) / 60;
          tr.innerHTML = `<td>${sector.name}</td><td>${sector.consumption}m, ${sector.speed}m/min</td><td>${bobinasPerMinute.toFixed(4)}</td>`;
        }
        resultTable.appendChild(tr);
      });

      // Cálculo da distribuição de bobinas
      const trips = [];
      let remainingDemand = [...sectors];
      let tripCounter = 1;

      while (remainingDemand.some(sector => (sector.consumption > 0 || sector.bobinasPerHour > 0))) {
        const trip = [];
        let totalBobinasForTrip = 0;

        remainingDemand.forEach(sector => {
          let bobinasForSector = 0;
          if (sector.isBobinasPerHour) {
            bobinasForSector = sector.bobinasPerHour / 60;
          } else {
            bobinasForSector = (sector.consumption / sector.speed) / 60;
          }

          if (totalBobinasForTrip + bobinasForSector <= rebocadorCapacityPerMinute) {
            trip.push(1);
            totalBobinasForTrip += bobinasForSector;
            if (!sector.isBobinasPerHour) {
              sector.consumption -= bobinasForSector;
            }
          } else {
            trip.push(0);
          }
        });

        trips.push(trip);
        tripCounter++;
      }

      // Preencher a tabela de distribuição
      trips.forEach((trip, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${index + 1}</td>` +
          trip.map((sector, i) => `<td>${sector ? "Sim" : "Não"}</td>`).join('');
        distributionTable.appendChild(tr);
      });
    });
  </script>
</body>
</html>
