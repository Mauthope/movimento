<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produção</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        .btn {
            padding: 5px 10px;
            cursor: pointer;
        }
        .input-machine {
            width: 80px;
        }
    </style>
</head>
<body>
    <h1>Controle de Produção - Setores e Máquinas</h1>

    <div id="sector-config">
        <h2>Configuração dos Setores</h2>

        <div id="impressao-setor">
            <h3>Impressão</h3>
            <div id="impressao-machines">
                <!-- Máquinas de impressão serão listadas aqui -->
            </div>
            <button class="btn" onclick="addMachine('impressao')">Adicionar Máquina de Impressão</button>
        </div>

        <div id="laminacao-setor">
            <h3>Laminação</h3>
            <div id="laminacao-machines">
                <!-- Máquinas de laminação serão listadas aqui -->
            </div>
            <button class="btn" onclick="addMachine('laminacao')">Adicionar Máquina de Laminação</button>
        </div>
    </div>

    <h2>Controle de Viagens</h2>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Impressão</th>
                <th>Laminação</th>
                <th>Corte 1</th>
                <th>Corte 2</th>
                <th>Atendimento</th>
            </tr>
        </thead>
        <tbody id="viagens-table">
            <!-- Viagens serão listadas aqui -->
        </tbody>
        <tfoot>
            <tr>
                <td><strong>Total</strong></td>
                <td><strong id="total-imp">0</strong></td>
                <td><strong id="total-lam">0</strong></td>
                <td><strong>0</strong></td>
                <td><strong>0</strong></td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <script>
        let viagens = [];
        let activeCronometer = null;
        let cronometroStartTime = null;
        let cronometroInterval = null;

        // Máquinas por setor
        let maquinasImpressao = [];
        let maquinasLaminacao = [];

        function addMachine(setor) {
            let machineInput = `<input type="number" class="input-machine" value="0" onchange="updateMachineTotal('${setor}')" />`;
            let machineId = setor === 'impressao' ? 'impressao-machines' : 'laminacao-machines';
            document.getElementById(machineId).innerHTML += machineInput;
            if (setor === 'impressao') {
                maquinasImpressao.push(0);
            } else {
                maquinasLaminacao.push(0);
            }
        }

        function updateMachineTotal(setor) {
            if (setor === 'impressao') {
                maquinasImpressao = Array.from(document.querySelectorAll('#impressao-machines input'))
                    .map(input => parseFloat(input.value) || 0);
            } else if (setor === 'laminacao') {
                maquinasLaminacao = Array.from(document.querySelectorAll('#laminacao-machines input'))
                    .map(input => parseFloat(input.value) || 0);
            }
            updateTotals();
        }

        function updateTotals() {
            const totalImp = maquinasImpressao.reduce((acc, value) => acc + value, 0);
            const totalLam = maquinasLaminacao.reduce((acc, value) => acc + value, 0);
            document.getElementById('total-imp').textContent = totalImp.toFixed(2);
            document.getElementById('total-lam').textContent = totalLam.toFixed(2);
        }

        function renderViagens() {
            const viagensTable = document.getElementById('viagens-table');
            viagensTable.innerHTML = viagens.map((viagem, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${viagem.imp}</td>
                    <td>${viagem.lam}</td>
                    <td>${viagem.cut1}</td>
                    <td>${viagem.cut2}</td>
                    <td><button class="btn" onclick="toggleCronometro(${index})">Atender</button></td>
                </tr>
            `).join('');
        }

        function toggleCronometro(index) {
            const viagem = document.querySelectorAll('table tr')[index + 1];
            const atendimentoBtn = viagem.querySelector('button');
            const atendimentoCell = viagem.querySelectorAll('td')[5]; // Coluna de Atendimento

            if (activeCronometer === index) {
                clearInterval(cronometroInterval);
                atendimentoBtn.textContent = 'Atender';
                const endTime = Date.now() - cronometroStartTime;
                const elapsedMinutes = endTime / 60000; // Convertendo milissegundos para minutos

                // Registrando o tempo de atendimento e colorindo a célula
                atendimentoCell.textContent = `${elapsedMinutes.toFixed(2)} min`;
                atendimentoCell.style.backgroundColor = (elapsedMinutes > parseFloat(document.getElementById('cycle-time').value)) ? 'red' : 'green';
                activeCronometer = null;
            } else {
                if (activeCronometer !== null) {
                    const prevViagem = document.querySelectorAll('table tr')[activeCronometer + 1];
                    prevViagem.querySelector('button').textContent = 'Atender';
                }
                atendimentoBtn.textContent = 'Finalizar Atendimento';
                activeCronometer = index;
                cronometroStartTime = Date.now();
                cronometroInterval = setInterval(() => {
                    console.log(`Cronômetro para viagem ${index + 1}`);
                }, 1000);
            }
        }

        // Inicialização
        addMachine('impressao');
        addMachine('laminacao');
    </script>
</body>
</html>
