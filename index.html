<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Distribuição de Bobinas</title>
  <style>
    .success { color: green; }
    .error { color: red; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #ddd; padding: 8px; text-align: center; }
  </style>
</head>
<body>
  <h1>Distribuição de Bobinas</h1>

  <label for="capacity">Capacidade do Rebocador (Bobinas por minuto):</label>
  <input type="number" id="capacity" placeholder="Capacidade do rebocador">
  <br>
  <label for="cycleTime">Tempo de ciclo (minutos):</label>
  <input type="number" id="cycleTime" placeholder="Tempo de ciclo">
  <br>
  <button id="calculateBtn">Calcular</button>

  <h2>Status</h2>
  <p id="statusText"></p>

  <h2>Tabela de Resultados</h2>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Setor</th>
        <th>Consumo / Velocidade</th>
        <th>Demanda por Minuto</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados dinâmicos serão inseridos aqui -->
    </tbody>
  </table>

  <h2>Tabela de Distribuição</h2>
  <table id="distributionTable">
    <thead>
      <tr>
        <th>Viagem</th>
        <th>Setor 1</th>
        <th>Setor 2</th>
        <th>Setor 3</th>
        <th>Setor 4</th>
        <th>Setor 5</th>
      </tr>
    </thead>
    <tbody>
      <!-- Distribuições dinâmicas serão inseridas aqui -->
    </tbody>
  </table>

  <script>
   document.getElementById("calculate").addEventListener("click", () => {
    // Limpeza anterior
    resultTable.innerHTML = "";
    distributionTable.innerHTML = "";
    statusText.textContent = "";

    const rebocadorCapacity = parseFloat(capacityInput.value) || 0;
    const cycleTime = parseFloat(cycleTimeInput.value) || 0;

    if (rebocadorCapacity <= 0 || cycleTime <= 0) {
        statusText.textContent = "Por favor, insira valores válidos para capacidade e tempo de ciclo.";
        statusText.className = "error";
        return;
    }

    const rebocadorCapacityPerMinute = rebocadorCapacity / cycleTime;
    let totalDemandPerMinute = 0;

    sectors.forEach(sector => {
        const bobinasPerMinute = sector.isBobinasPerHour 
            ? sector.bobinasPerHour / 60 
            : (sector.consumption / sector.speed) / 60 * sector.multiplier;
        totalDemandPerMinute += bobinasPerMinute;

        // Popula tabela de resultados
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${sector.name}</td>
            <td>${sector.isBobinasPerHour ? `Bobinas por Hora: ${sector.bobinasPerHour}` : `${sector.consumption}m, ${sector.speed}m/min`}</td>
            <td>${bobinasPerMinute.toFixed(4)}</td>`;
        resultTable.appendChild(tr);
    });

    // Verifica capacidade
    if (totalDemandPerMinute <= rebocadorCapacityPerMinute) {
        statusText.textContent = "O rebocador tem capacidade suficiente!";
        statusText.className = "success";
    } else {
        statusText.textContent = "A capacidade do rebocador não é suficiente.";
        statusText.className = "error";
    }

    // Calcular distribuição
    let trips = [];
    let remainingDemand = [...sectors];
    while (remainingDemand.some(sector => sector.consumption > 0 || sector.isBobinasPerHour)) {
        let trip = [];
        let totalBobinas = 0;

        remainingDemand.forEach(sector => {
            let bobinasForTrip = sector.isBobinasPerHour 
                ? sector.bobinasPerHour / 60 
                : (sector.consumption / sector.speed) / 60 * sector.multiplier;

            if (totalBobinas + bobinasForTrip <= rebocadorCapacityPerMinute) {
                totalBobinas += bobinasForTrip;
                trip.push(bobinasForTrip.toFixed(2));
                if (!sector.isBobinasPerHour) {
                    sector.consumption -= bobinasForTrip * sector.speed * 60 / sector.multiplier;
                } else {
                    sector.bobinasPerHour = 0;
                }
            } else {
                trip.push(0);
            }
        });

        trips.push(trip);
    }

    trips.forEach((trip, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${index + 1}</td>` + trip.map(val => `<td>${val}</td>`).join("");
        distributionTable.appendChild(tr);
    });
});

  </script>
</body>
</html>
